<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Software PWM: Any pin PWM Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MajicDesigns_Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Software PWM
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Software PWM for any digital pin</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Any pin PWM Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library is designed to provide 'software' PWM output for any digital pin.</p>
<p>Important Notes:</p><ul>
<li>This library uses AVR TIMER1 or TIMER2 to implement the interrupt driven clock. TIMER0 is used by the Arduino millis() clock, TIMER1 is commonly used by the Servo library and TIMER2 by the Tone library. Change USE_TIMER (defined at the top of the header file) to select which timer is enabled in the library code.</li>
<li>This library has been tested on Arduino Uno and Nano (ie, 328P processor). It should work on other AVR chips (eg, MEGA) with slight modifications but it will not work on non-AVR architectures without some extensive rework.</li>
</ul>
<h1>Why use Software PWM?</h1>
<p>The Uno and Nano have 6 hardware PWM pins (3, 5, 6, 9, 10, 11). However, of these pins, the following also have alternative functions:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pin   </th><th class="markdownTableHeadNone">Alternate Use    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">External Interrupt    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">-    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">6   </td><td class="markdownTableBodyNone">-    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">9   </td><td class="markdownTableBodyNone">-    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">10   </td><td class="markdownTableBodyNone">SPI SS (default)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">11   </td><td class="markdownTableBodyNone">SPI MOSI   </td></tr>
</table>
<p>So, if the application requires 2 external interrupts and an SPI interface, there are really only 3 PWM hardware signals available for additional control. As an example, for 2 DC motors with a PWM controller, 4 PWM signals are required, so we don't have enough hardware PWM pins to get the job done.</p>
<p>One solution is to change hardware to a processor with more PWM pins. Another is to create a PWM solution that uses software to drive the pins.</p>
<p>This second option is feasible, especially when the PWM signal needed is relatively low frequency. The downside is that the CPU is used process the timer interrupt and toggle the PWM digital output, taking processing time away from other tasks.</p>
<p>The original use case for this library was for PWM speed control of brushed DC motors. The default Arduino Uno/Nano PWM frequency is 490.2 Hz for pins 3, 9, 10, 11 and 976.56 Hz for pins 5 and 6. These frequencies are actually too high to properly drive DC motors at low duty cycles, as the current through the motor coils does not rise fast enough to provide motive force through the motors. See this excellent summary from Adafruit <a href="https://learn.adafruit.com/improve-low-speed-performance-of-brushed-dc-motors/pwm-frequency">https://learn.adafruit.com/improve-low-speed-performance-of-brushed-dc-motors/pwm-frequency</a>.</p>
<h1>Implementation</h1>
<p>This library implements user defined frequency PWM output for any digital pin software limited to MAX_FREQUENCY Hz.</p>
<p>The TIMERn is set for 255 times this frequency (eg, 200Hz becomes 51kHz). This causes the TIMERn interrupt routine to be called 255 times for each PWM cycle and, depending on where it is in the cycle, allows the software to set the digital output pin to LOW or HIGH, thus creating the desired PWM signal. This is illustrated below.</p>
<p><img src="PWM_Timing.png" alt="" class="inline" title="PWM Timing Diagram"/></p>
<p>The duty cycle can be changed very smoothly by changing the set point at which the digital transition occurs. The new duty cycle takes effect at the next PWM digital transition.</p>
<p>TIMERn is a global resource, so each object instance of class is driven from the same TIMERn interrupt. The constant MAX_PWM_PIN is used to set limits the global maximum for instances allowed to be processed by the interrupt.</p>
<p>See Also</p><ul>
<li><a class="el" href="page_revision_history.html">Revision History</a></li>
<li><a class="el" href="page_donation.html">Support the Library</a></li>
<li><a class="el" href="page_copyright.html">Copyright</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Mar 20 2021 09:24:52 for Software PWM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
